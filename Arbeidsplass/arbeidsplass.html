<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="skjema.css" />
    <meta charset="UTF-8">
</head>

<body>
    <form id="skjema">
        <p>
            <label for="namn" data-title="Fornamn og etternamn må inkluderast." >
                Navn<em>*</em> : </label>
            <input id="namn" type="text" placeholder="Skriv navnet ditt her:" required>
        </p>
        <p><label for="kjonn">Kjønn<em>*</em> :</label>
            <input id="kjonn" type="text" list="valgKjonn" required>
            <datalist id="valgKjonn">
                <option value="Mann"></option>
                <option value="Kvinne"></option>
            </datalist>
        </p>
        <p><label for="fodDato">Fødselsdato<em>*</em> : </label>
            <input id="fodDato" type="date" min="1950-01-01" max="2000-01-01" required>
        </p>
        <p>
            <label for="postkode" data-title="Skriv inn din firesifra postkode. Ikkje inkluder posstad.">
                Postkode<em>*</em> : </label>
            <input id="postkode" type="number" required>
        </p>
        <p>
            <label for="adresse" data-title="Skriv inn di bustadsadresse.">
                Adresse<em>*</em> : </label>
            <input id="adresse" type="text" required>
        </p>
        <p><label for="telefonNr"> Telefonnummer:</label>
            <input id="telefonNr" type="number">
        </p>
        <p><label for="hobbyer"> Hobbyer:</label><br>
            <input id="Idrett" type="checkbox" value="Idrett">Idrett<br>
            <input id="Matlaging" type="checkbox" value="Matlaging">Matlaging<br>
            <input id="Lesing" type="checkbox" value="Lesing">Lesing<br>
            <input id="Koding" type="checkbox" value="koding">Koding<br>
            <input id="Camping" type="checkbox" value="camping">Camping<br>
        </p>
    </form>
    <button id="sendInfo" onclick="createObject(findBirthDate())">Send Inn</button>
    <p id="listOfPersons">List of persons: </p>
    <p id="personInfo"></p>
    <button id="clearStorage" onclick="clearStorage()">Omstill</button>
    <script>

        class Person {
            constructor(name, gender, birthDate, postalCode, adress, phoneNumber, hobbies) {
                this._name = name;
                this._gender = gender;
                this._birthDate = birthDate;
                this._postalCode = postalCode;
                this._adress = adress;
                this._phoneNumber = phoneNumber;
                this._hobbies = hobbies;
            }

            get name() {
                return this._name;
            }

            set name(name) {
                if (typeof name === "string") {
                    this._name = name;
                }
            }

            get gender() {
                return this._gender;
            }

            set gender(gender) {
                if (typeof gender === "string") {
                    this._gender = gender;
                }
            }

            get birthDate() {
                return this._birthDate;
            }

            set birthDate(birthDate) {
                if (typeof birthDate === "number") {
                    this._birthDate = birthDate;
                }
            }

            get postalCode() {
                return this._postalCode;
            }

            set postalCode(postalCode) {
                if (typeof postalCode === "number") {
                    this._postalCode = postalCode;
                }
            }

            get adress() {
                return this._adress;
            }

            set adress(adress) {
                if (typeof adress === "string") {
                    this._adress = adress;
                }
            }

            get phoneNumber() {
                return this._phoneNumber;
            }

            set phoneNumber(phoneNumber) {
                if (typeof phoneNumber === "string") {
                    this._phoneNumber = phoneNumber;
                }
            }

            get hobbies() {
                return this._hobbies;
            }

            set hobbies(hobbies) {
                if (hobbies.isArray()) {
                    this._hobbies = hobbies;
                }
            }

        }

        let personObjects = [];
        let test = JSON.parse(localStorage.getItem("personList"));
        if (test[0] != null) {
            if (!test[0] != undefined) {
                personObjects = JSON.parse(localStorage.getItem("personList"));
                for (let a = 0; a < personObjects.length; a++) {
                    document.getElementById("listOfPersons").innerHTML += "<br>" + personObjects[a];
            }
        }   
    }

        function validateText(textID) {
            var re = /^[A-Za-z]+$/;
            if (!(re.test(document.getElementById(textID).value))) {
                alert(`${textID} is NOT correct!`);
                return false;
            } else {
                return true;
            }
        }

        function validateNumber(numberID) {
            var re = /^[0-9]+$/;
            if (!(re.test(document.getElementById(numberID).value))) {
                return false;
            } else {
                return true;
            }
        }

        function findName() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    let personName = document.getElementById("namn").value;
                    if (validateText("namn") === false) {
                        reject(false);
                    } else {
                        resolve(personName);
                    }
                }, 200)
            });
        }

        function findGender() {
            let gender = document.getElementById("kjonn").value;
            return gender;
        }

        function findBirthDate() {
            let fullBirthDate = [];
            let birthday = document.getElementById("fodDato").value;
            let year = birthday.substr(0, 4);
            fullBirthDate.push(year);
            let month = birthday.substr(5, 2);
            fullBirthDate.push(month);
            let day = birthday.substr(8, 2);
            fullBirthDate.push(day);
            return fullBirthDate;
        }

        function findPostalCode() {
            let postalCode = document.getElementById("postkode").value;
            return postalCode;
        }

        function findAdress() {
            let adress = document.getElementById("adresse").value;
            return adress;
        }

        function findPhoneNumber() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    let phoneNumber = document.getElementById("telefonNr").value;
                    if (phoneNumber.length === 0) {
                        let emptyPhoneNumber = "No information";
                        resolve(emptyPhoneNumber);
                    }
                    else if (validateNumber("telefonNr") === false) {
                        reject(false);
                    } else {
                        resolve(phoneNumber);
                    }
                }, 500)
            });
        }

        function isChecked(id) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (id.checked === true) {
                        resolve(true);
                    } else {
                        resolve(false);
                    }
                }, 200)
            });
        }

        async function findHobbies() {
            let hobbies = ["Idrett", "Matlaging", "Lesing", "Koding", "Camping"];
            let confirmedHobbies = [];
            for (let i = 0; i < hobbies.length; i++) {
                if (await isChecked(document.getElementById(hobbies[i]))) {
                    confirmedHobbies.push(hobbies[i]);
                }
            }
            let hobbiesString = confirmedHobbies.join(`, `);
            return hobbiesString;
        }

        async function createObject(birthDayArray) {
            try {
                let fullBirthDate = `${birthDayArray[2]}.${birthDayArray[1]}.${birthDayArray[0]}`
                let newPerson = new Person(await findName(), findGender(), fullBirthDate, findPostalCode(), findAdress(), await findPhoneNumber(), await findHobbies());
                if (!(newPerson.name === false) || (!(newPerson.phoneNumber === false))) {
                    document.getElementById("personInfo").innerHTML =
                    `Name: ${newPerson.name} <br>
                    Gender: ${newPerson.gender} <br>
                    Birth Date: ${newPerson.birthDate} <br>
                    Postal Code: ${newPerson.postalCode} <br>
                    Adress: ${newPerson.adress} <br>
                    Phone Number: ${newPerson.phoneNumber} <br>
                    Hobbies: ${newPerson.hobbies}`;
                }
                personObjects.push(newPerson.name);
                localStorage.setItem("personList", JSON.stringify(personObjects));
            }
            catch (err) {
                alert(err);
            }
        }

        function clearStorage() {
            localStorage.removeItem("personList");
            location.reload();
        }

    </script>
</body>

</html>