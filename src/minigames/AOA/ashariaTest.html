<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="gameSheet.css" />
</head>

<body background="Regiontest1.png" style="background-repeat:no-repeat;height:1269px;overflow:visible"
    onkeydown="movePlayer(event)">

    <div id="popUp" class="popup">
        <div id="popup-content" class="popup-content">
            <span class="close" onclick="closeWindow();">&times;</span>
            <p style="position: absolute; top: 16px" ;>Name: </p>
            <input type="text" id="name" style="position: absolute; top: 28px; left: 70px">
            <p style="position: absolute; top: 41px" ;>Class: </p>
            <select id="characterClass" onchange="changeClass();" style="position: absolute; top: 55px; left: 67px" ;>
                <option disabled selected value>Select Class:</option>
                <option value="Cleric">Cleric</option>
                <option value="Wizard">Wizard</option>
                <option value="Paladin">Paladin</option>
                <option value="Rogue">Rogue</option>
                <option value="Ranger">Ranger</option>
                <!--<option value="Druid">Druid</option> -->
            </select>
            <p style="position: absolute; top: 66px" ;>Race: </p>
            <select id="characterRace" style="position: absolute; top: 80px; left: 67px" ;>
                <option disabled selected value>Select Race:</option>
                <option value="Human">Human</option>
                <option value="Elf">Elf</option>
                <option value="Dwarf">Dwarf</option>
                <option value="Lizardfolk">Lizardfolk</option>
            </select>
            <p id="characterVIT" class="characterValues" style="position: absolute; right: 200px">VIT: </p>
            <p id="characterSTR" class="characterValues" style="position: absolute; right: 200px; top: 40px">STR: </p>
            <p id="characterWIS" class="characterValues" style="position: absolute; right: 200px; top: 60px">WIS: </p>
            <p id="characterDEX" class="characterValues" style="position: absolute; right: 200px; top: 80px">DEX: </p>
            <p id="characterSPE" class="characterValues" style="position: absolute; right: 200px; top: 100px">SPE: </p>
            <p id="characterHP" class="characterValues" style="position: absolute; right: 200px; top: 140px">HP: </p>
            <p id="characterMP" class="characterValues" style="position: absolute; right: 200px; top: 160px">MP: </p>
            <p id="formError" style="position: absolute; right: 39%; top: 475px; visibility: hidden; color: red;">There
                are fields that needs to be filled out!</p>
            <button id="closeMenu" onclick="startGame();" style="position: absolute; bottom: 5px; left: 45%">Start
                Game</button>
        </div>
    </div>

    <p id="chosenName" style="position: absolute; right: 700px; top: 200px">Name: </p>
    <p id="chosenTypes" style="position: absolute; right: 700px; top: 250px">Race & Class: </p>
    <p id="chosenVIT" style="position: absolute; right: 700px; top: 270px">VIT: </p>
    <p id="chosenSTR" style="position: absolute; right: 700px; top: 290px">STR: </p>
    <p id="chosenWIS" style="position: absolute; right: 700px; top: 310px">WIS: </p>
    <p id="chosenDEX" style="position: absolute; right: 700px; top: 330px">DEX: </p>
    <p id="chosenSPE" style="position: absolute; right: 700px; top: 350px">SPE: </p>
    <p id="chosenHP" style="position: absolute; right: 700px; top: 390px">HP: </p>
    <p id="chosenMP" style="position: absolute; right: 700px; top: 410px">MP: </p>

    <p id="player1Name" style="visibility: hidden; position: absolute; left: 100px; top: 100px;"></p>
    <p id="enemy1Name" style="visibility: hidden; position: absolute; right: 300px; top: 100px;"></p>
    <p id="player1HP" class="statBar" style="visibility: hidden; position: absolute; left: 100px; top: 150px;"></p>
    <p id="player1curHP" class="remainingValues"
        style="visibility: hidden; position: absolute; left: 100px; top: 150px;"></p>
    <p id="player1HPNumber" style="visibility: hidden; position: absolute; left: 310px; top: 150px;"></p>
    <p id="player1MP" class="statBar" style="visibility: hidden; position: absolute; left: 100px; top: 200px;"></p>
    <p id="player1curMP" class="remainingValues"
        style="visibility: hidden; position: absolute; left: 100px; top: 200px; background-color: blue;"></p>
    <p id="player1MPNumber" style="visibility: hidden; position: absolute; left: 310px; top: 200px;"></p>
    <p id="enemy1HP" class="statBar" style="visibility: hidden; position: absolute; right: 100px; top: 150px;"></p>
    <p id="enemy1curHP" class="remainingValues"
        style="visibility: hidden; position: absolute; right: 100px; top: 150px;"></p>
    <p id="enemy1HPNumber" style="visibility: hidden; position: absolute; right: 310px; top: 150px;"></p>
    <p id="enemy1MP" class="statBar" style="visibility: hidden; position: absolute; right: 100px; top: 200px;"></p>
    <p id="enemy1curMP" class="remainingValues"
        style="visibility: hidden; position: absolute; right: 100px; top: 200px; background-color: blue;"></p>
    <p id="enemy1MPNumber" style="visibility: hidden; position: absolute; right: 310px; top: 200px;"></p>

    <button id="playerAbilities" class="menuButtons" onmousedown="buttonClicked(this)" onmouseup="buttonUnclicked(this)"
        onclick="showMoves()" style="position: absolute; visibility: hidden; bottom: 8%; left: 10px;">Abilities</button>
    <button id="playerItems" class="menuButtons" onmousedown="buttonClicked(this)" onmouseup="buttonUnclicked(this)"
        style="position: absolute; visibility: hidden; bottom: 5%; left: 10px;">Items</button>
    <button id="goBack" class="menuButtons" onmousedown="buttonClicked(this)" onmouseup="buttonUnclicked(this)"
        onclick="returnToBattleMenu() "style="position: absolute; visibility: hidden; bottom: 5%; left: 10px;">Back</button>
    <button id="playerFlee" class="menuButtons" onmousedown="buttonClicked(this)" onmouseup="buttonUnclicked(this)"
        onclick="toMenu()" style="position: absolute; visibility: hidden; bottom: 2%; left: 10px;">Flee</button>
    <button onclick="startBattle()" id="battleTest" style="position: absolute; top: 5%; right: 5%">To Battle</button>

    <canvas id="canvas" width="1700" height="1600"></canvas>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.6.3/fabric.min.js"></script>
<script src="battleScreen.js"></script>
<script src="character.js"></script>
<script src="move.js"></script>
<script src="monster.js"></script>
<script src="levels.js"></script>
<script>

    //Template values for playable characters.
    const STR = 10;
    const SPE = 10;
    const VIT = 10;
    const WIS = 10;
    const DEX = 10;
    const HP = 10 + (3 * VIT);
    const MP = 10 + (2 * WIS);
    let amountOfCharacters = 0;
    let currentCharacters = [];

    //First playable character.
    let player1 = new Character("", "", "", 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, ["Normal Strike"]);
    amountOfCharacters++;
    currentCharacters.push(player1);

    //Position of player on map.
    let curX = 350;
    let curY = 250;

    //Popup-menu for character customisation.
    let popup = document.getElementById("popUp");
    let content = document.getElementById("popup-content");
    let span = document.getElementsByClassName("close")[0];
    popup.style.display = "block";

    let fabCanvas = new fabric.Canvas("canvas");
    fabCanvas.setWidth(1700);
    fabCanvas.setHeight(1600);

    let gameStarted = false;
    let onMapScreen = true;

    //Stops player from scrolling down when moving character.
    document.body.style.overflow = "hidden";

    const interval = setInterval(draw, 10);

    loadTemplateValues();

    /**
     * Draws the player onto the map.
     */
    function draw() {
        if (onMapScreen == true) {
            fabCanvas.clear();
            let player = new fabric.Circle({
                left: curX, top: curY, fill: "blue", radius: 6, hoverCursor: "pointer", visible: true, selectable: false
            });
            fabCanvas.add(player);
        }
    }

    /**
     * Checks if arrow-keys are pressed, then moves character accordingly.
     */
    function movePlayer(e) {
        if (gameStarted == true) {
            console.log(curY);
            if (curY > 900 && curY < 955) {
                document.body.style.overflow = "visible";
            }
            else {
                document.body.style.overflow = "hidden";
            }
            switch (e.keyCode) {
                case 37:
                    curX -= 5;
                    console.log("Venstre");
                    break;
                case 38:
                    console.log("Opp");
                    curY -= 5;
                    break;
                case 39:
                    console.log("HÃ¸gre");
                    curX += 5;
                    break;
                case 40:
                    console.log("Ned");
                    curY += 5;
                    break;
            }
        }
    }

    /**
     * Closes the pop-up window.
     */
    function closeWindow() {
        popup.style.display = "none";
    }

    /**
     * Collects the input from pop-up window and starts the game for the player.
     * Shows error if player has missing information.
     */
    function startGame() {
        if (document.getElementById("name").value != "" && document.getElementById("characterClass").value != "" &&
            document.getElementById("characterRace").value != "") {
            document.getElementById("formError").style.visibility = "hidden";
            gameStarted = true;
            player1.name = document.getElementById("name").value;
            closeWindow();
            document.getElementById("chosenName").innerHTML = "Name: " + player1.name;
            player1.race = document.getElementById("characterRace").value;
            player1.class = document.getElementById("characterClass").value;
            document.getElementById("chosenTypes").innerHTML = "Race & Class: " + player1.race + " " + player1.class;
            document.getElementById("chosenVIT").innerHTML = "VIT: " + player1.vit;
            document.getElementById("chosenSTR").innerHTML = "STR: " + player1.str;
            document.getElementById("chosenWIS").innerHTML = "WIS: " + player1.wis;
            document.getElementById("chosenDEX").innerHTML = "DEX: " + player1.dex;
            document.getElementById("chosenSPE").innerHTML = "SPE: " + player1.spe;
            document.getElementById("chosenHP").innerHTML = "HP: " + player1.hpLeft + "/" + player1.hp;
            document.getElementById("chosenMP").innerHTML = "MP: " + player1.mpLeft + "/" + player1.mp;


        }
        else {
            document.getElementById("formError").style.visibility = "visible";
        }
    }

    /**
     * Loads template values of character stats.
     */
    function loadTemplateValues() {
        document.getElementById("characterVIT").innerHTML = "VIT: " + VIT;
        document.getElementById("characterSTR").innerHTML = "STR: " + STR;
        document.getElementById("characterWIS").innerHTML = "WIS: " + WIS;
        document.getElementById("characterDEX").innerHTML = "DEX: " + DEX;
        document.getElementById("characterSPE").innerHTML = "SPE: " + SPE;
        document.getElementById("characterHP").innerHTML = "HP: " + HP;
        document.getElementById("characterMP").innerHTML = "MP: " + MP;
    }

    /**
     * Gives characters correct HP and MP based on VIT and WIS stats.
     */
    function correctStats() {
        player1.hp = 10 + (3 * player1.vit);
        player1.hpLeft = player1.hp;
        player1.mp = 10 + (2 * player1.wis);
        player1.mpLeft = player1.mp;
        document.getElementById("characterHP").innerHTML = "HP: " + player1.hp;
        document.getElementById("characterMP").innerHTML = "MP: " + player1.mp;

    }

    /**
     * Changes the stat values shown on screen every time user changes class in pop-up window.
     */
    function changeClass() {
        let chosenClass = document.getElementById("characterClass").value;
        switch (chosenClass) {
            case "Cleric":
                document.getElementById("characterVIT").innerHTML = "VIT: " + (VIT + 2);
                document.getElementById("characterSTR").innerHTML = "STR: " + (STR - 3);
                document.getElementById("characterWIS").innerHTML = "WIS: " + (WIS + 3);
                document.getElementById("characterDEX").innerHTML = "DEX: " + DEX;
                document.getElementById("characterSPE").innerHTML = "SPE: " + (SPE - 2);
                player1.vit = VIT + 2, player1.str = STR - 3, player1.wis = WIS + 3, player1.dex = DEX, player1.spe = SPE - 2;
                break;
            case "Paladin":
                document.getElementById("characterVIT").innerHTML = "VIT: " + (VIT + 2);
                document.getElementById("characterSTR").innerHTML = "STR: " + (STR + 3);
                document.getElementById("characterWIS").innerHTML = "WIS: " + (WIS - 1);
                document.getElementById("characterDEX").innerHTML = "DEX: " + (DEX - 3);
                document.getElementById("characterSPE").innerHTML = "SPE: " + (SPE - 1);
                player1.vit = VIT + 2, player1.str = STR + 3, player1.wis = WIS - 1, player1.dex = DEX - 3, player1.spe = SPE - 1;
                break;
            case "Wizard":
                document.getElementById("characterVIT").innerHTML = "VIT: " + (VIT - 2);
                document.getElementById("characterSTR").innerHTML = "STR: " + (STR - 3);
                document.getElementById("characterWIS").innerHTML = "WIS: " + (WIS + 3);
                document.getElementById("characterDEX").innerHTML = "DEX: " + DEX;
                document.getElementById("characterSPE").innerHTML = "SPE: " + (SPE + 2);
                player1.vit = VIT - 2, player1.str = STR - 3, player1.wis = WIS + 3, player1.dex = DEX, player1.spe = SPE + 2;
                break;
            case "Rogue":
                document.getElementById("characterVIT").innerHTML = "VIT: " + (VIT - 3);
                document.getElementById("characterSTR").innerHTML = "STR: " + STR;
                document.getElementById("characterWIS").innerHTML = "WIS: " + (WIS - 2);
                document.getElementById("characterDEX").innerHTML = "DEX: " + (DEX + 2);
                document.getElementById("characterSPE").innerHTML = "SPE: " + (SPE + 3);
                player1.vit = VIT - 3, player1.str = STR, player1.wis = WIS - 2, player1.dex = DEX + 2, player1.spe = SPE + 3;
                break;
            case "Ranger":
                document.getElementById("characterVIT").innerHTML = "VIT: " + (VIT - 2);
                document.getElementById("characterSTR").innerHTML = "STR: " + (STR - 2);
                document.getElementById("characterWIS").innerHTML = "WIS: " + WIS;
                document.getElementById("characterDEX").innerHTML = "DEX: " + (DEX + 3);
                document.getElementById("characterSPE").innerHTML = "SPE: " + (SPE + 1);
                player1.vit = VIT - 2, player1.str = STR - 2, player1.wis = WIS, player1.dex = DEX + 3, player1.spe = SPE + 1;
                break;
            /*else if (chosenClass == "Druid") {
                document.getElementById("characterVIT").innerHTML = "VIT: " + (VIT-3);
                document.getElementById("characterSTR").innerHTML = "STR: " + (STR-2);
                document.getElementById("characterWIS").innerHTML = "WIS: " + (WIS+2);
                document.getElementById("characterDEX").innerHTML = "DEX: " + (DEX+2);
                document.getElementById("characterSPE").innerHTML = "SPE: " + (SPE+1);
            } */
            default:
                document.getElementById("characterVIT").innerHTML = "VIT: " + VIT;
                document.getElementById("characterSTR").innerHTML = "STR: " + STR;
                document.getElementById("characterWIS").innerHTML = "WIS: " + WIS;
                document.getElementById("characterDEX").innerHTML = "DEX: " + DEX;
                document.getElementById("characterSPE").innerHTML = "SPE: " + SPE;
                player1.vit = VIT, player1.str = STR, player1.wis = WIS, player1.dex = DEX, player1.spe = SPE;
                break;
        }
        correctStats();
    }

</script>

</html>