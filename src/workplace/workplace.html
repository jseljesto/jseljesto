<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="stylesheet.css" />
    <meta charset="UTF-8">
</head>

<body>
    <form id="skjema">
        <p>
            <label for="name" data-title="Firstname and lastname must be included.">
                Name<em>*</em> : </label>
            <input id="name" type="text" placeholder="Write your name here:" required>
        </p>
        <p><label for="gender">Gender<em>*</em> :</label>
            <input id="gender" type="text" list="chooseGender" required>
            <datalist id="chooseGender">
                <option value="Male"></option>
                <option value="Female"></option>
            </datalist>
        </p>
        <p><label for="birthDate">Birth Date<em>*</em> : </label>
            <input id="birthDate" type="date" min="1950-01-01" max="2000-01-01" required>
        </p>
        <p>
            <label for="postCode" data-title="Write your four number postcode. Do not include location.">
                Postcode<em>*</em> : </label>
            <input id="postCode" type="number" required>
        </p>
        <p>
            <label for="address" data-title="Write your address here.">
                Address<em>*</em> : </label>
            <input id="address" type="text" required>
        </p>
        <p><label for="phoneNumber"> phone Number:</label>
            <input id="phoneNumber" type="number">
        </p>
        <p><label for="hobbies"> Hobbies:</label><br>
            <input id="athletics" type="checkbox" value="Athletics">Athletics<br>
            <input id="cooking" type="checkbox" value="Cooking">Cooking<br>
            <input id="reading" type="checkbox" value="Reading">Reading<br>
            <input id="programming" type="checkbox" value="Programming">Programming<br>
            <input id="camping" type="checkbox" value="Camping">Camping<br>
        </p>
    </form>

    <button id="sendInfo" onclick="createPerson(findBirthDate())">Send Inn</button>
    <button onclick="location.reload()" style="position: absolute; 
    top: 420px; left: 45%">Create new person</button>
    <p id="listOfPersons">List of persons: </p>
    <p id="personInfo"></p>
    <button id="clearStorage" onclick="clearLocalStorage()">Reset</button>
    <input id="searchBar" type="text" style="position: absolute; top: 580px;">
    <button id="searchPerson" onclick="searchForPerson()" style="position: fixed; 
    top: 580px; left: 15%;">SÃ¸k</button>
    <p id="personSearched" style="position: absolute; top: 565px; left: 45%; "></p>
    <script>

        class Person {
            constructor(name, gender, birthDate, postalCode, address, phoneNumber, hobbies) {
                this._name = name;
                this._gender = gender;
                this._birthDate = birthDate;
                this._postalCode = postalCode;
                this._address = address;
                this._phoneNumber = phoneNumber;
                this._hobbies = hobbies;
            }

            get name() {
                return this._name;
            }

            set name(name) {
                if (typeof name === "string") {
                    this._name = name;
                }
            }

            get gender() {
                return this._gender;
            }

            set gender(gender) {
                if (typeof gender === "string") {
                    this._gender = gender;
                }
            }

            get birthDate() {
                return this._birthDate;
            }

            set birthDate(birthDate) {
                if (typeof birthDate === "number") {
                    this._birthDate = birthDate;
                }
            }

            get postalCode() {
                return this._postalCode;
            }

            set postalCode(postalCode) {
                if (typeof postalCode === "number") {
                    this._postalCode = postalCode;
                }
            }

            get address() {
                return this._address;
            }

            set address(address) {
                if (typeof address === "string") {
                    this._address = address;
                }
            }

            get phoneNumber() {
                return this._phoneNumber;
            }

            set phoneNumber(phoneNumber) {
                if (typeof phoneNumber === "string") {
                    this._phoneNumber = phoneNumber;
                }
            }

            get hobbies() {
                return this._hobbies;
            }

            set hobbies(hobbies) {
                if (hobbies.isArray()) {
                    this._hobbies = hobbies;
                }
            }

        }

        let personObjects = [];
        const importedObjects = JSON.parse(localStorage.getItem("personObjects"));
        if (importedObjects) {
            personObjects = JSON.parse(localStorage.getItem("personObjects"));
            for (let a = 0; a <= personObjects.length; a++) {
                document.getElementById("listOfPersons").innerHTML += "<br>" + personObjects[a]._name;
            }
        }

        function validateText(textID) {
            const re = /^[A-Za-z]+$/;
            if (!(re.test(document.getElementById(textID).value))) {
                alert(`${textID} is NOT correct!`);
                return false;
            } else {
                return true;
            }
        }

        function validateNumber(numberID) {
            const re = /^[0-9]+$/;
            if (!(re.test(document.getElementById(numberID).value))) {
                alert(`${textID} is NOT correct!`);
                return false;
            } else {
                return true;
            }
        }

        function findName() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    let personName = document.getElementById("name").value;
                    if (validateText("name") === false) {
                        reject(false);
                    } else {
                        resolve(personName);
                    }
                }, 200)
            });
        }

        function findGender() {
            let gender = document.getElementById("gender").value;
            if (gender) {
                return gender;
            } else {
                alert("Gender is NOT correct!");
                return false;
            }
        }

        function findBirthDate() {
            let birthDayArray = [];
            let inputDate = document.getElementById("birthDate").value;
            let year = inputDate.substr(0, 4);
            birthDayArray.push(year);
            let month = inputDate.substr(5, 2);
            birthDayArray.push(month);
            let day = inputDate.substr(8, 2);
            birthDayArray.push(day);
            if (!day || !month || !year) {
                alert("Birthdate is NOT correct!");
                return false;
            } else {
                return birthDayArray;
            }
        }

        function findPostalCode() {
            let postalCode = document.getElementById("postCode").value;
            if (postalCode) {
                return postalCode;
            } else {
                alert("Postal Code is NOT correct!");
                return false;
            }
        }

        function findAddress() {
            let address = document.getElementById("address").value;
            if (address) {
                return address;
            } else {
                alert("Address is NOT correct!");
                return false;
            }
        }

        function findPhoneNumber() {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    let phoneNumber = Number(document.getElementById("phoneNumber").value);
                    if (phoneNumber.length === 0) {
                        const emptyPhoneNumber = "No valid information";
                        resolve(emptyPhoneNumber);
                    }
                    else if (validateNumber("phoneNumber") === false) {
                        reject(false);
                    } else {
                        resolve(phoneNumber);
                    }
                }, 500)
            });
        }

        function isChecked(id) {
            return new Promise((resolve, reject) => {
                setTimeout(() => {
                    if (id.checked === true) {
                        resolve(true);
                    } else {
                        resolve(false);
                    }
                }, 200)
            });
        }

        async function findHobbies() {
            const hobbies = ["athletics", "cooking", "reading", "programming", "camping"];
            let confirmedHobbies = [];
            for (let i = 0; i < hobbies.length; i++) {
                if (await isChecked(document.getElementById(hobbies[i]))) {
                    confirmedHobbies.push(hobbies[i]);
                }
            }
            let listOfConfirmedHobbies = confirmedHobbies.join(`, `);
            return listOfConfirmedHobbies;
        }

        async function createPerson(birthDayArray) {
            try {
                let fullBirthDate = `${birthDayArray[2]}.${birthDayArray[1]}.${birthDayArray[0]}`
                let newPerson = new Person(await findName(), findGender(), fullBirthDate,
                    findPostalCode(), findAddress(), await findPhoneNumber(), await findHobbies());
                personObjects.push(newPerson);
                if (newPerson.name && newPerson.gender && newPerson.phoneNumber
                    && newPerson.postalCode && newPerson.address) {
                    document.getElementById("personInfo").innerHTML =
                        `Name: ${newPerson.name} <br>
                    Gender: ${newPerson.gender} <br>
                    Birth Date: ${newPerson.birthDate} <br>
                    Postal Code: ${newPerson.postalCode} <br>
                    Address: ${newPerson.address} <br>
                    Phone Number: ${newPerson.phoneNumber} <br>
                    Hobbies: ${newPerson.hobbies}`;
                }
                localStorage.setItem("personObjects", JSON.stringify(personObjects));
            }
            catch (err) {
                alert(err);
            }
        }

        function searchForPerson() {
            let searchedName = document.getElementById("searchBar").value;
            for (let p = 0; p <= personObjects.length; p++) {
                if (searchedName === personObjects[p]._name) {
                    document.getElementById("personSearched").innerHTML =
                        `Name: ${personObjects[p]._name} <br>
                    Gender: ${personObjects[p]._gender} <br>
                    Birth Date: ${personObjects[p]._birthDate} <br>
                    Postal Code: ${personObjects[p]._postalCode} <br>
                    Address: ${personObjects[p]._address} <br>
                    Phone Number: ${personObjects[p]._phoneNumber} <br>
                    Hobbies: ${personObjects[p]._hobbies}`;
                }
            }
        }

        function clearLocalStorage() {
            localStorage.removeItem("personObjects");
            location.reload();
        }

    </script>
</body>

</html>